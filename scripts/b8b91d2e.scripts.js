"use strict";angular.module("12oder3App",["firebase","lodash","ngAnimate","ngTouch","ngRoute"]).config(["$routeProvider","$compileProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"views/admin-dashboard.html",controller:"AdminDashboardCtrl"}).when("/admin-add-questions",{templateUrl:"views/admin-add-questions.html",controller:"AdminAddQuestionsCtrl"}).when("/play/:qid",{templateUrl:"views/play.html",controller:"PlayCtrl",resolve:{load:function(a,b,c){var d=a.defer(),e=b.current.params.qid;return c.fBase.questions.$child(e).$on("loaded",function(){d.resolve("questions loaded")}),d.promise}}}).when("/set-user/:userType",{template:"<h1>Setting user type ...</h1>",controller:"SetUserTypeCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/play-dashboard/:qid",{templateUrl:"views/play-dashboard.html",controller:"PlayDashboardCtrl"}).when("/wait-dashboard",{templateUrl:"views/wait-dashboard.html",controller:"WaitDashboardCtrl"}).when("/wait",{templateUrl:"views/wait.html",controller:"WaitCtrl"}).otherwise({redirectTo:"/"})}]).run(["data","$location","$rootScope","helpers","Localstorage",function(a,b,c,d){b.path();a.init(),(d.userType("user")||d.userType("dashboard"))&&(c.playPage=d.userType("user")?a.fBase.playPage:a.fBase.playDashboard,c.playPage.$on("loaded",function(){var a=c.playPage.$value;b.path(a)}),c.playPage.$on("change",function(){b.path(c.playPage.$value)}))}]),angular.module("12oder3App").controller("MainCtrl",["$scope","$location","$document","data","helpers","_","Uuids","Localstorage",function(a,b,c,d,e,f,g,h){c.find("body").addClass("login"),a.name=h.get("name");var i=h.get("userType")||"user";a.currentUser=d.fBase.currentUser,"dashboard"==i&&b.path("/dashboard"),a.saveName=function(b){d.fBase.currentUser.$child("name").$set(b),a.name=b}}]),angular.module("12oder3App").factory("data",["$firebase","$http","$q","$rootScope","_","Localstorage","Uuids",function(a,b,c,d,e,f){function g(){var b=c.defer();h.playPage=a(new Firebase(h.firebaseUrl+"playPage/")),h.playDashboard=a(new Firebase(h.firebaseUrl+"playDashboard/")),h.activeQuestion=a(new Firebase(h.firebaseUrl+"activeQuestion/")),h.playTimer=a(new Firebase(h.firebaseUrl+"playTimer/")),h.questions=a(new Firebase(h.firebaseUrl+"questions/")),h.users=a(new Firebase(h.firebaseUrl+"users/")),h.votes=a(new Firebase(h.firebaseUrl+"votes/"));var d=f.get("uuid");return d?(h.currentUser=a(new Firebase(h.firebaseUrl+"users/"+d)),b.resolve()):h.users.$add("newUser").then(function(c){d=c.name(),h.currentUser=a(new Firebase(h.firebaseUrl+"users/"+d)),f.set("uuid",d),f.set("userType","user"),b.resolve()}),b.promise}var h={firebaseUrl:"https://12oder3.firebaseio.com/"};return{init:g,fBase:h,timeOut:10}}]),angular.module("12oder3App").factory("helpers",["Uuids","Localstorage",function(a,b){return{getRandom:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},userType:function(a){var c=b.get("userType")||"user";return-1!=c.indexOf(a)}}}]),angular.module("12oder3App").service("Localstorage",function(){var a="12oder3_",b=function(){return Math.round((new Date).getTime()/1e3)};return{get:function(c){var d=JSON.parse(localStorage.getItem(a+c)||null);return d&&d.expires&&("never"==d.expires||d.expires>b())?d.data:(localStorage.removeItem(a+c),null)},set:function(c,d,e){var f=e?e+b():"never",g={data:d,expires:f};localStorage.setItem(a+c,JSON.stringify(g))}}}),angular.module("lodash",[]).factory("_",["$window",function(a){return a._}]),angular.module("12oder3App").factory("Uuids",function(){return{newuuid:function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")}}}),angular.module("12oder3App").controller("AdminDashboardCtrl",["$scope","$document","$rootScope","Localstorage","$interval","$timeout","data","helpers",function(a,b,c,d,e,f,g,h){function i(){var a=g.fBase.activeQuestion,b=g.fBase.users;b.$on("loaded",function(){for(var c=b.$getIndex(),d=4;d>=0;d--)angular.forEach(_.shuffle(c),function(b){var c=a.$value;f(function(){g.fBase.votes.$child(c+"/"+b).$set({vote:"a"+h.getRandom(1,3),team:h.getRandom(1,3)})},h.getRandom(20,5e3))})})}var j;b.find("body").addClass("admin"),a.timeOut=g.timeOut,a.questions=g.fBase.questions,a.usedQuestions=[],g.fBase.playTimer.$bind(a,"playTimer"),g.fBase.playTimer.$set(g.timeOut+1),a.waitMode=function(){g.fBase.playDashboard.$set("/wait-dashboard"),g.fBase.playPage.$set("/wait"),g.fBase.activeQuestion.$set("none"),e.cancel(j),j=void 0},a.alocate=function(){var a=0;angular.forEach(g.fBase.users.$getIndex(),function(b){a=3===a?1:a+1,g.fBase.users.$child(b).$child("team").$set(a)})},a.usedQuestion=function(b){return-1==a.usedQuestions.indexOf(b)?!1:!0},a.reset=function(){g.fBase.users.$remove(),g.fBase.votes.$remove(),g.fBase.playDashboard.$set("/"),g.fBase.playPage.$set("/")},a.setQuestion=function(b){g.fBase.playPage.$set("/play/"+b),g.fBase.playDashboard.$set("/play-dashboard/"+b),g.fBase.activeQuestion.$set(b),a.playTimer=g.timeOut+1},a.startTimer=function(b){a.usedQuestions.push(b),e.cancel(j),j=void 0,a.playTimer=g.timeOut,j=e(function(){0==a.playTimer?(e.cancel(j),j=void 0):a.playTimer-=1},1e3)},a.fakeVoting=i,a.fakeUsers=function(){for(var a=70;a>=0;a--)f(function(){var a="Austin, Camden, Cameron, Emmett, Griffin, Harrison, Hudson, Jace, Jonah, Kingston, Lincoln, Marcus, Nash, Nathan, Oliver, Parker, Ryan, Ryder, Seth, Xavier".split(", ");g.fBase.users.$add({name:a[h.getRandom(0,19)]+" "+a[h.getRandom(0,19)],score:h.getRandom(0,19)})},h.getRandom(20,5e3))}}]),angular.module("12oder3App").controller("AdminAddQuestionsCtrl",["$scope","Localstorage","data",function(a,b,c){var d={question:"Question description",a1:"answer 1",a2:"answer 2",a3:"answer 3",correctAnswer:"a1",longAnswer:"",votes:0};a.questions=c.fBase.questions,a.remainingVotes=null==b.get("remainingVotes")?10:b.get("remainingVotes"),a.$watch("remainingVotes",function(a,c){a!==c&&b.set("remainingVotes",a)}),a.addQuestion=function(){a.questions.$add(d)},a.upVote=function(b){a.questions[b].votes+=1,a.questions.$save(b),a.remainingVotes-=1},a.downVote=function(b){a.questions[b].votes-=1,a.questions.$save(b),a.remainingVotes-=1},a.delete=function(b){a.questions.$remove(b)},a.save=function(b){a.questions.$save(b)},a.saveQuestions=function(){a.questions.$save()}}]),angular.module("12oder3App").controller("PlayCtrl",["$scope","$routeParams","$document","$location","Localstorage","data","_",function(a,b,c,d,e,f){function g(){var b=!1;if(a.lastVote==a.currentQuestion.correctAnswer){b=!0;var c=a.userScore.$value||0;console.log((new Date).getTime(),"oldScore",c,a.lastVote,a.currentQuestion.correctAnswer);var d=c+1;console.log("newScore",d,(new Date).getTime()),a.userScore.$set(d)}else console.log("Wrong Answer!");return b}var h=b.qid,i=e.get("uuid");a.timeOut=f.timeOut,a.userScore=f.fBase.currentUser.$child("score"),a.currentQuestion=f.fBase.questions.$child(h),a.currentUser=f.fBase.currentUser,a.activeQuestion=f.fBase.activeQuestion,a.playTimer=f.fBase.playTimer.$value,a.timeOver=!1,f.fBase.playTimer.$on("change",function(){a.playTimer=f.fBase.playTimer.$value,0===a.playTimer&&(a.isItRight=g(),a.timeOver=!0)}),a.currentUser.$on("loaded",function(){console.log(a.currentUser),angular.element(c[0].querySelector(".team-bar")).addClass("team-"+a.currentUser.team)}),a.vote=function(b){f.fBase.votes.$child(h+"/"+i).$set({vote:b,team:a.currentUser.team}),a.lastVote=b}}]),angular.module("12oder3App").controller("SetUserTypeCtrl",["$scope","$routeParams","$location","Localstorage",function(a,b,c,d){"admin"==b.userType||"dashboard"==b.userType?d.set("userType",b.userType):c.path("/")}]),angular.module("12oder3App").controller("DashboardCtrl",["$scope","$location","Localstorage","data",function(a,b,c,d){a.users=d.fBase.users}]),angular.module("12oder3App").controller("PlayDashboardCtrl",["$scope","$routeParams","$location","$timeout","Localstorage","data",function(a,b,c,d,e,f){{var g=b.qid;e.get("uuid")}a.timeOut=f.timeOut,a.currentQuestion=f.fBase.questions.$child(g),a.currentUser=f.fBase.currentUser,a.playTimer=f.fBase.playTimer.$value,a.currentVotes=f.fBase.votes.$child(g),f.fBase.playTimer.$on("change",function(){a.playTimer=f.fBase.playTimer.$value,0==a.playTimer&&d(function(){a.revealAnswer=!0},2e3)})}]),angular.module("12oder3App").controller("WaitDashboardCtrl",["$scope","$location","$timeout","$document","Localstorage","helpers","data",function(a,b,c,d,e,f,g){var h=0;a.users=g.fBase.users,a.teamScore={1:0,2:0,3:0};for(var i=[],j=9;j>=0;j--)i.push(f.getRandom(1,5));a.setRandomActive=i,c(function(){[].forEach.call(d[0].querySelectorAll(".cube"),function(a){angular.element(a).addClass("set-face-6")})},1e4),a.users.$on("loaded",function(){angular.forEach(a.users.$getIndex(),function(b){var c=a.users[b].score||0;1==a.users[b].team&&(a.teamScore[1]=a.teamScore[1]+c),2==a.users[b].team&&(a.teamScore[2]=a.teamScore[2]+c),3==a.users[b].team&&(a.teamScore[3]=a.teamScore[3]+c),h+=b.score})})}]),angular.module("12oder3App").controller("WaitCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);
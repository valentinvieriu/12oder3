"use strict";angular.module("12oder3App",["firebase","lodash","ngAnimate","ngRoute"]).config(["$routeProvider","$compileProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"views/admin-dashboard.html",controller:"AdminDashboardCtrl"}).when("/admin-add-questions",{templateUrl:"views/admin-add-questions.html",controller:"AdminAddQuestionsCtrl"}).when("/play/:qid",{templateUrl:"views/play.html",controller:"PlayCtrl",resolve:{load:function(a,b,c){var d=a.defer(),e=b.current.params.qid;return c.fBase.questions.$child(e).$on("loaded",function(){d.resolve("questions loaded")}),d.promise}}}).when("/set-user/:userType",{template:"<h1>Setting user type ...</h1>",controller:"SetUserTypeCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/play-dashboard/:qid",{templateUrl:"views/play-dashboard.html",controller:"PlayDashboardCtrl"}).when("/wait-dashboard",{templateUrl:"views/wait-dashboard.html",controller:"WaitDashboardCtrl"}).when("/wait",{templateUrl:"views/wait.html",controller:"WaitCtrl"}).otherwise({redirectTo:"/"})}]).run(["data","$location","$rootScope","helpers","Localstorage",function(a,b,c,d,e){var f=(b.path(),e.get("name"));a.init(),(d.userType("user")||d.userType("dashboard"))&&(c.playPage=d.userType("user")?a.fBase.playPage:a.fBase.playDashboard,c.playPage.$on("loaded",function(){var a=c.playPage.$value;f&&b.path(a)}),c.playPage.$on("change",function(a){f=e.get("name"),f&&b.path(a)}))}]),angular.module("12oder3App").controller("MainCtrl",["$scope","$location","data","helpers","_","Uuids","Localstorage",function(a,b,c,d,e,f,g){a.name=g.get("name"),a.currentUser=c.fBase.currentUser,a.saveName=function(b){g.set("name",b),c.fBase.currentUser.$child("name").$set(b),a.name=b}}]),angular.module("12oder3App").factory("data",["$firebase","$http","$q","$rootScope","_","Localstorage","Uuids",function(a,b,c,d,e,f){function g(){var b=c.defer();h.playPage=a(new Firebase(h.firebaseUrl+"playPage/")),h.playDashboard=a(new Firebase(h.firebaseUrl+"playDashboard/")),h.activeQuestion=a(new Firebase(h.firebaseUrl+"activeQuestion/")),h.playTimer=a(new Firebase(h.firebaseUrl+"playTimer/")),h.questions=a(new Firebase(h.firebaseUrl+"questions/")),h.users=a(new Firebase(h.firebaseUrl+"users/")),h.votes=a(new Firebase(h.firebaseUrl+"votes/"));var d=f.get("uuid");return d?(h.currentUser=a(new Firebase(h.firebaseUrl+"users/"+d)),b.resolve()):h.users.$add("newUser").then(function(c){d=c.name(),h.currentUser=a(new Firebase(h.firebaseUrl+"users/"+d)),f.set("uuid",d),f.set("userType","user"),b.resolve()}),b.promise}var h={firebaseUrl:"https://12oder3.firebaseio.com/"};return{init:g,fBase:h,timeOut:10}}]),angular.module("12oder3App").factory("helpers",["Uuids","Localstorage",function(a,b){return{getRandom:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},userType:function(a){var c=b.get("userType")||"user";return-1!=c.indexOf(a)}}}]),angular.module("12oder3App").service("Localstorage",function(){var a="12oder3_",b=function(){return Math.round((new Date).getTime()/1e3)};return{get:function(c){var d=JSON.parse(localStorage.getItem(a+c)||null);return d&&d.expires&&("never"==d.expires||d.expires>b())?d.data:(localStorage.removeItem(a+c),null)},set:function(c,d,e){var f=e?e+b():"never",g={data:d,expires:f};localStorage.setItem(a+c,JSON.stringify(g))}}}),angular.module("lodash",[]).factory("_",["$window",function(a){return a._}]),angular.module("12oder3App").factory("Uuids",function(){return{newuuid:function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")}}}),angular.module("12oder3App").controller("AdminDashboardCtrl",["$scope","Localstorage","$interval","data","helpers",function(a,b,c,d){var e;a.timeOut=d.timeOut,a.questions=d.fBase.questions,a.usedQuestions=[],d.fBase.playTimer.$bind(a,"playTimer"),d.fBase.playTimer.$set(d.timeOut+1),a.waitMode=function(){d.fBase.playDashboard.$set("/wait-dashboard"),d.fBase.playPage.$set("/wait"),d.fBase.activeQuestion.$set("none"),c.cancel(e),e=void 0},a.alocate=function(){var a=0;angular.forEach(d.fBase.users.$getIndex(),function(b){a=3===a?1:a+1,d.fBase.users.$child(b).$child("team").$set(a)})},a.usedQuestion=function(b){return-1==a.usedQuestions.indexOf(b)?!1:!0},a.reset=function(){d.fBase.users.$remove(),d.fBase.votes.$remove(),d.fBase.playDashboard.$set("/"),d.fBase.playPage.$set("/")},a.setQuestion=function(b){d.fBase.playPage.$set("/play/"+b),d.fBase.playDashboard.$set("/play-dashbard/"+b),d.fBase.activeQuestion.$set(b),a.playTimer=d.timeOut+1},a.startTimer=function(b){a.usedQuestions.push(b),c.cancel(e),e=void 0,a.playTimer=d.timeOut,e=c(function(){0==a.playTimer?(c.cancel(e),e=void 0):a.playTimer-=1},1e3)}}]),angular.module("12oder3App").controller("AdminAddQuestionsCtrl",["$scope","Localstorage","data",function(a,b,c){var d={question:"Question description",a1:"answer 1",a2:"answer 2",a3:"answer 3",correctAnswer:"a1",longAnswer:"",votes:0};a.questions=c.fBase.questions,a.remainingVotes=null==b.get("remainingVotes")?10:b.get("remainingVotes"),a.$watch("remainingVotes",function(a,c){a!==c&&b.set("remainingVotes",a)}),a.addQuestion=function(){a.questions.$add(d)},a.upVote=function(b){a.questions[b].votes+=1,a.questions.$save(b),a.remainingVotes-=1},a.downVote=function(b){a.questions[b].votes-=1,a.questions.$save(b),a.remainingVotes-=1},a.delete=function(b){a.questions.$remove(b)},a.save=function(b){a.questions.$save(b)},a.saveQuestions=function(){a.questions.$save()}}]),angular.module("12oder3App").controller("PlayCtrl",["$scope","$routeParams","$location","Localstorage","data",function(a,b,c,d,e){var f=b.qid,g=d.get("uuid");a.timeOut=e.timeOut,a.currentQuestion=e.fBase.questions.$child(f),a.currentUser=e.fBase.currentUser,a.activeQuestion=e.fBase.activeQuestion,a.playTimer=e.fBase.playTimer.$value,e.fBase.playTimer.$on("change",function(){a.playTimer=e.fBase.playTimer.$value}),a.activeQuestion.$on("loaded",function(){a.activeQuestion.$value!=f&&c.path("/")}),a.vote=function(b){e.fBase.votes.$child(f+"/"+g).$set(b),a.lastVote=b},a.isItRight=function(){return a.lastVote==a.currentQuestion.correctAnswer}}]),angular.module("12oder3App").controller("SetUserTypeCtrl",["$scope","$routeParams","$location","Localstorage",function(a,b,c,d){"admin"==b.userType||"dashboard"==b.userType?d.set("userType",b.userType):c.path("/")}]),angular.module("12oder3App").controller("DashboardCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("12oder3App").controller("PlayDashboardCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("12oder3App").controller("WaitDashboardCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("12oder3App").controller("WaitCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);